#! /bin/bash
OPT=" -D_FORTRAN_US -D_TEST_MAIN -D_C_US -D_MPI -D_ELPH -D_CUDA"
#
rm -f driver/lib/*.o driver/lib/*.a driver/interface/*.o driver/include/*.a driver.x

cd driver

cd interface
cp get_the_version.F get_the_version.f90
file_list=`find . -maxdepth 1 -type f | grep -E '\.f90' |grep -v .swp`
for file in $file_list; do
 echo $file
 mpif90 -c $file -I../../include/ 
done
ar -r ../include/driver_lib.a *.o
cd ../

cd interface
file_list=`find . -maxdepth 1 -type f | grep -E '\.c' |grep -v .swp`
for file in $file_list; do
 echo $file
 mpicc $OPT -c $file -I../include  -I../../include/headers/common 
done
ar -r ../include/driver_lib.a *.o
cd ../

cd lib
file_list=`find . -maxdepth 1 -type f | grep -E '\.c' |grep -v .swp`
for file in $file_list; do
 echo $file
 mpicc $OPT -c $file -I../include  -I../../include/headers/common 
done
ar -r ../include/driver_lib.a *.o
cd ../


mpicc $OPT -c driver.c -I include -I options -I ../include/headers/common/
cp yambo.F yambo.f90
gfortran -c yambo.f90
cd ../

rm -f driver.x
mpif90 -o driver.x driver/driver.o driver/yambo.o driver/include/driver_lib.a

./driver.x -x -J jobA1,jobBBB2 -O ODIRONE -I TESTONE -C COMUNICONE -F input_file -nompi -noopenmp -setup -opt chi -Q

#./driver.x -x -optics c -y d -J jobA1,jobBBB2 -O ODIRONE -I TESTONE -C COMUNICONE -F input_file -t

