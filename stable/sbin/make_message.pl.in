#!/usr/bin/perl -w
#
# Copyright (C) 2000-2016 C. Hogan and the YAMBO team
#              http://www.yambo-code.org
#
# This file is distributed under the terms of the GNU
# General Public License. You can redistribute it and/or
# modify it under the terms of the GNU General Public
# License as published by the Free Software Foundation;
# either version 2, or (at your option) any later version.
#
# This program is distributed in the hope that it will
# be useful, but WITHOUT ANY WARRANTY; without even the
# implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.
#
# You should have received a copy of the GNU General Public
# License along with this program; if not, write to the Free
# Software Foundation, Inc., 59 Temple Place - Suite 330,Boston,
# MA 02111-1307, USA or visit http://www.gnu.org/copyleft/gpl.txt.
#
# Wonderful script to generate a commit message template (CDH)
# Usage: In the YAMBO root directory
# sbin/makemsg    or
# sbin/makemsg -p="Myrta"   if a patch was supplied by e.g. Myrta
#
use Getopt::Long;
&GetOptions("p=s"          => \$patchname);
#
# Collect the files marked by svn status
#
$svncommand = "svn status | grep -v \"?\" | awk \'{printf\" %s \",\$2 }\' |";
open(SVN, $svncommand);
$changedfiles = <SVN>;
close(SVN);
# Strip the "src/" (add to this list if needed)
$changedfiles =~ s/  / /g;
$changedfiles =~ s/src\///g;
$changedfiles =~ s/interfaces\///g;
print "Identified modified files: $changedfiles\n";
#
# Write the commit message
#
open(MSGFILE,">","commit.msg") or die "The file commit.msg could " .
   "not be opened.\n";
print MSGFILE "Version @SVERSION@.@SPATCHLEVEL@.@SSUBLEVEL@ \n\n";
print MSGFILE "* $changedfiles\n\n";
print MSGFILE "Bugs:\n";
print MSGFILE "- \n";
print MSGFILE "Additions:\n";
print MSGFILE "- \n";
print MSGFILE "Changes:\n";
print MSGFILE "- \n";
if($patchname) {print MSGFILE "Patch sent by: $patchname\n"};
close(MSGFILE);
print "Edit the commit.msg file and commit/patch with -F commit.msg \n";
