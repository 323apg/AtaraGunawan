 !
 ! Plasma gas procedure. Save for later use
 !======================================================
 !
 do i_qp1=1,QP_n_states
   !
   if (QP_table(i_qp1,3)/=i_k) cycle
   !
   if (.not.PAR_IND_QP%element_1D(i_qp1)) cycle
   i_qp1_mem=PAR_QP_index(i_qp1)
   !
   i_n =QP_table(i_qp1,1)
   i_np=QP_table(i_qp1,2)
   !
   do iqbz=1,q%nbz
     !
     if (.not.PAR_IND_Q%element_1D(iqbz)) cycle
     i_q_mem=PAR_Q_index(iqbz)
     !
     i_q   = q%sstar(iqbz,1)
     i_q_s = q%sstar(iqbz,2)
     i_kmq = k%sstar(qindx_S(i_k,iqbz,1),1)
     !
     !f_kmq=-cI*G_lesser(i_np,i_np,RT_ibz_coo(i_kmq,1))/spin_occ
     !
     do i_J=1,N_plasma_poles(iqbz)
       !
       !
       do i_J_bg=Plasma_grid(1,i_J,iqbz),Plasma_grid(2,i_J,iqbz)
         !
         i_qp2= Plasma_tab(1,i_J_bg,iqbz)
         if (.not.PAR_IND_QPp%element_1D(i_qp2)) cycle
         i_qp2_mem=PAR_QPp_index(i_qp2)
         !
         i_p_s= Plasma_tab(2,i_J_bg,iqbz)       
         !
         i_m  = QP_table(i_qp2,1)
         i_mp = QP_table(i_qp2,2)
         i_p  = QP_table(i_qp2,3)
         !
         f_p=-cI*G_lesser(i_m,i_m,RT_ibz_coo(i_p,1))/spin_occ
         !
         call RT_EE_scattering_kinematics(k,q,i_p,i_p_s,i_q,i_q_s,i_pmq_bz,i_pmq_G0)
         !
         i_pmq =k%sstar(i_pmq_bz,1)
         !
         f_pmq =-cI*G_lesser(i_mp,i_mp,RT_ibz_coo(i_pmq,1))
         !
         pre_factor=abs(4.*pi*COLLISIONS(i_qp1_mem)%v3(i_qp2_mem,i_p_s,i_q_mem))**2
         !
         Gr_integral=Gr_ee_matrix(i_qp1_mem,i_qp2_mem,i_q_mem,i_p_s)
         !
         f_E_factor=(1._SP-f_kmq)*(1._SP-f_p)*f_pmq
         f_H_factor=f_kmq*f_p*(2._SP-f_pmq)
         !
         E_E_Electron_lifetime(i_n,RT_ibz_coo(i_k,1))= E_E_Electron_lifetime(i_n,RT_ibz_coo(i_k,1))+&
  &                                                   pre_factor*Gr_integral*f_E_factor
         E_E_Hole_lifetime(i_n,RT_ibz_coo(i_k,1))    = E_E_Hole_lifetime(i_n,RT_ibz_coo(i_k,1))+&
  &                                                   pre_factor*Gr_integral*F_H_factor
         !
       enddo
       !
     enddo
     !
   enddo
   !
 enddo
 !
end subroutine RT_Coulomb_relaxation
